{% extends 'base.html' %}

{% block content %}
  <h1>Recommended</h1>
  {% for genre in genres %}
    <form class="recommend-form" data-recommend-id="{{ genre.pk }}">
      {% comment %} if user is  {% endcomment %}
      {% csrf_token %}
      <button class="btn btn-primary" id="recommend-{{ genre.pk }}">{{ genre.name }}</button>
    </form>
  {% endfor %}
  <div></div>

  
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const forms = document.querySelectorAll('.recommend-form')
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

    forms.forEach(form => {
      form.addEventListener('submit', function(event) {
        event.preventDefault()
        const recommendId = event.target.dataset.recommendId
        
        axios({
          method: 'post',
          url: `http://127.0.0.1:8000/movies/recommended/${recommendId}/`,
          headers: {'X-CSRFToken' : csrftoken}
        })
        .then(response => {
          console.log(response.data.movies)
        })
      })
    })
  
  </script>

{% endblock %}
